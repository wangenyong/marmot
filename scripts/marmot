#!/bin/bash

# get script current dir and project home dir
SCRIPT_DIR=$(dirname -- "$(readlink -f -- "$BASH_SOURCE")")
HOME_DIR="$(dirname $SCRIPT_DIR)"

# print logo
cat $HOME_DIR/conf/welcome.figlet
printf -- '\n'
printf -- '\n'

# loading config file
source $HOME_DIR/conf/config.conf
# loading printf file
source $HOME_DIR/conf/printf.conf

# no arguments
if [ ${#@} -eq 0 ]; then
    if [ ! -d "$PROJECT_DIR" ]; then
        printf -- "The project have not been installed.\n"
        printf -- "You can install it by command: ${BOLD}${NORMAL}marmot install { hadoop | kettle | kafka }${END}\n"
        printf -- '\n'
    fi
    exit 0
fi

case "$1" in
install)
    case "$2" in
    "hadoop")
        sh $SCRIPT_DIR/config-environment.sh
        sh $SCRIPT_DIR/deploy-jdk.sh
        # sh $SCRIPT_DIR/deploy-hadoop.sh
        ;;
    "kettle")
        printf -- "kettle\n"
        ;;
    *)
        printf -- "${BOLD}USAGE: ${NORMAL}marmot install { hadoop | kettle | kafka }${END}\n"
        printf -- '\n'
        ;;
    esac

    ;;
remove)
    IFS=',' read -ra array <<<$HADOOP_WORKERS
    for host in ${array[@]}; do
        echo =============== $host ===============
        ssh $host "rm -rf /opt/marmot; rm -f /etc/profile.d/marmot_env.sh"
    done
    ;;
*)
    echo "default (none of above)"
    ;;
esac
